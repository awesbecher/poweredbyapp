
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Powered_by: Custom AI Agents for SMBs</title>
    <meta name="description" content="Deploy bespoke voice, email & SMS AI agents to automate support, sales & scheduling for your small to medium business. Get started with Powered_by Agency." />
    <meta name="author" content="Powered_by Agency" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
    <meta property="og:title" content="Custom AI Agents for SMBs | Powered_by Agency" />
    <meta property="og:description" content="Deploy bespoke voice, email & SMS AI agents to automate support, sales & scheduling for your small to medium business." />
    <meta property="og:type" content="website" />
    <link rel="icon" href="/lovable-uploads/6824f512-cd18-4a70-ba33-41c138d9be24.png" />
    
    <!-- Load Tally script immediately - moved to HEAD -->
    <script async src="https://tally.so/widgets/embed.js" crossorigin="anonymous"></script>
    
    <!-- Critical preloads for external resources -->
    <link rel="preconnect" href="https://tally.so" crossorigin />
    <link rel="dns-prefetch" href="https://tally.so" />
    <link rel="preconnect" href="https://www.youtube.com" crossorigin />
    <link rel="dns-prefetch" href="https://www.youtube.com" />
    <link rel="preconnect" href="https://www.youtube-nocookie.com" crossorigin />
    <link rel="dns-prefetch" href="https://www.youtube-nocookie.com" />

    <style>
      /* Global styles for embedded content */
      .embed-container {
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background-color: rgba(0, 0, 0, 0.05);
        min-height: 100px;
      }
      
      /* Enhanced Tally specific styles */
      .tally-embed {
        width: 100% !important;
        min-height: 350px !important;
        border: none !important;
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
      }
      
      /* Make sure any iframe fits properly */
      iframe {
        max-width: 100%;
        border: 0;
      }
      
      /* Specific height overrides for different form types */
      .agent-tally-form iframe {
        min-height: 1400px !important; /* Increased height to ensure visibility */
      }
      
      /* Ensure placeholders look nice while loading */
      .embed-placeholder {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        min-height: inherit;
        background-color: rgba(0, 0, 0, 0.05);
      }
    </style>
  </head>

  <body>
    <div id="root"></div>
    <!-- IMPORTANT: DO NOT REMOVE THIS SCRIPT TAG OR THIS VERY COMMENT! -->
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Direct embed initializer that doesn't rely on the Tally global object -->
    <script>
      // Enhanced embed management
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM fully loaded - initializing embeds');
        
        // Initialize all embeds on page load
        initializeAllEmbeds();
        
        // Set up observers for route changes and DOM updates
        setupObservers();
        
        // Additional initialization after a short delay
        setTimeout(initializeAllEmbeds, 1000);
        setTimeout(initializeAllEmbeds, 3000);
      });
      
      // Handle window load event separately
      window.addEventListener('load', function() {
        console.log('Window load event fired - ensuring embeds are initialized');
        initializeAllEmbeds();
        setTimeout(initializeAllEmbeds, 1500);
      });
      
      // Function to initialize all embedded content
      function initializeAllEmbeds() {
        // Initialize Tally forms
        if (window.Tally) {
          try {
            window.Tally.loadEmbeds();
            console.log('Tally embeds initialized via global object');
          } catch (e) {
            console.error('Error initializing Tally via global object:', e);
            directlyInjectTallyForms();
          }
        } else {
          console.log('Tally global object not available, using direct injection');
          directlyInjectTallyForms();
        }
        
        // Ensure YouTube videos are loaded properly
        refreshYouTubeEmbeds();
      }
      
      // Direct injection fallback for Tally forms when the global object fails
      function directlyInjectTallyForms() {
        document.querySelectorAll('[data-tally-src]').forEach(function(container) {
          if (!container.querySelector('iframe')) {
            const iframe = document.createElement('iframe');
            iframe.src = container.getAttribute('data-tally-src');
            iframe.width = '100%';
            iframe.height = container.getAttribute('data-tally-height') || '500';
            iframe.title = 'Tally Form';
            iframe.setAttribute('frameborder', '0');
            iframe.style.width = '100%';
            iframe.style.height = container.getAttribute('data-tally-height') || '500px';
            iframe.style.border = 'none';
            container.innerHTML = '';
            container.appendChild(iframe);
            console.log('Directly injected Tally iframe for', iframe.src);
          }
        });
      }
      
      // Function to refresh YouTube embeds
      function refreshYouTubeEmbeds() {
        document.querySelectorAll('iframe[src*="youtube"]').forEach(function(iframe) {
          const currentSrc = iframe.src;
          if (currentSrc) {
            iframe.src = '';
            setTimeout(function() {
              iframe.src = currentSrc;
              console.log('Refreshed YouTube iframe:', currentSrc);
            }, 100);
          }
        });
      }
      
      // Set up mutation observers to detect DOM changes
      function setupObservers() {
        const observer = new MutationObserver(function(mutations) {
          let shouldCheckEmbeds = false;
          
          mutations.forEach(function(mutation) {
            if (mutation.type === 'childList' && mutation.addedNodes.length) {
              shouldCheckEmbeds = true;
            }
          });
          
          if (shouldCheckEmbeds) {
            setTimeout(initializeAllEmbeds, 100);
          }
        });
        
        // Start observing the document body for added nodes
        observer.observe(document.body, { 
          childList: true, 
          subtree: true 
        });
      }
    </script>
  </body>
</html>
